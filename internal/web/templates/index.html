<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>gomac</title>
<style>
body {
  font-family: monospace;
  background: #f0f0f0;
  color: #000;
}
h1 { font-size: 24px; margin-bottom: 20px; }
.switch-box { padding: 10px; margin-bottom: 20px; background: #fff; border: 2px solid #000; }
.switch-title { font-weight: bold; margin-bottom: 5px; cursor: pointer; }
.port {
  width: 30px; height: 30px; text-align: center; line-height: 30px;
  border: 1px solid #000; cursor: pointer; font-size: 10px;
  text-decoration: none; color: #000; box-sizing: border-box;
}
.port.up { background: #0f0; }
.port.down { background: #f00; }
.port.flap { background: rgb(255, 120, 0); }
.port-details { display: none; margin-top: 5px; padding: 5px; border-top: 1px solid #000; background: #eee; }
table { border-collapse: collapse; margin-top: 5px; width: 100%; }
th, td { border: 1px solid #000; padding: 4px 8px; text-align: left; }
.up-text { color: green; font-weight: bold; }
.down-text { color: red; font-weight: bold; }

.port-panel { display: inline-block; margin-bottom: 8px; }
.port-row {
  display: flex; flex-wrap: wrap; gap: 4px; justify-content: flex-start;
  max-width: min(100%, calc(30px * 28 + 4px * 28));
}
#siteSelector {
  background: #fff;
  color: #000;
  border: 2px solid #000;
  padding: 4px 6px;
  border-radius: 4px;
  font-family: monospace;
  cursor: pointer;
}
#siteSelector:hover {
  background: #e0e0e0;
}
.menu-bar {
  background: #ddd;
  padding: 5px 10px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.menu-bar a {
  margin-right: 15px; text-decoration: none; color: #000; font-weight: bold;
}
.menu-bar a:hover { text-decoration: underline; }
.toggle-btn {
  background: #fff;
  color: #000;
  border: 2px solid #000;
  padding: 4px 6px;
  border-radius: 4px;
  font-family: monospace;
  cursor: pointer;
}
.toggle-btn:hover {
  background: #e0e0e0;
}

/* --- DARK MODE --- */
body.dark {
  background: #121212;
  color: #eee;
}
body.dark .switch-box {
  background: #1e1e1e;
  border-color: #555;
}
body.dark .menu-bar {
  background: #333;
}
body.dark .menu-bar a { color: #eee; }
body.dark .toggle-btn {
  background: #1e1e1e;
  color: #eee;
  border-color: #555;
}
body.dark .toggle-btn:hover {
  background: #2a2a2a;
}
body.dark .port { border-color: #555; color: #fff; }
body.dark .port.up { background: rgb(0, 200, 0); }
body.dark .port.down { background: rgb(200, 0, 0); }
body.dark .port.flap { background: rgb(255, 120, 0); }
body.dark .port-details { background: #222; border-color: #444; }
body.dark #siteSelector {
  background: #1e1e1e;
  color: #eee;
  border-color: #555;
}
body.dark #siteSelector:hover {
  background: #2a2a2a;
}
</style>
<script>
function togglePortDetail(switchId, portIndex) {
  const divId = 'port-detail-' + switchId + '-' + portIndex;
  const clickedDiv = document.getElementById(divId);

  // Hide all other port detail divs
  const allDetails = document.querySelectorAll('.port-details');
  allDetails.forEach(div => {
    if (div !== clickedDiv) {
      div.style.display = 'none';
    }
  });

  // Toggle the clicked one
  if (clickedDiv.style.display === 'none' || clickedDiv.style.display === '') {
    clickedDiv.style.display = 'block';
  } else {
    clickedDiv.style.display = 'none';
  }
}

function toggleDarkMode() {
  document.body.classList.toggle('dark');
  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
}

function changeSite() {
  const site = document.getElementById("siteSelector").value;
  localStorage.setItem("activeSite", site);

  document.querySelectorAll(".switch-box").forEach(box => {
    if (box.dataset.site === site) box.style.display = "block";
    else box.style.display = "none";
  });
}

window.onload = function () {
  // Restore dark mode
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark');
  }

  // Restore last selected site
  const savedSite = localStorage.getItem("activeSite");
  const selector = document.getElementById("siteSelector");

  if (savedSite) {
    selector.value = savedSite;
  }

  // Apply site filter
  changeSite();
};
</script>
</head>
<body>
<h1>gomac</h1>


<div class="menu-bar">
  <div>
    <a href="/">Dashboard</a>
    <a href="/mac">MAC Search</a>
    <a href="/admin">Manage Switches</a>
  </div>

  <div style="display:flex; align-items:center; gap:8px;">
    <select id="siteSelector" onchange="changeSite()">
      {{range .Sites}}
        <option value="{{.}}">{{.}}</option>
      {{end}}
    </select>

    <div class="toggle-btn" onclick="toggleDarkMode()">Dark Mode</div>
  </div>
</div>

{{range .Switches}}
<div class="switch-box" data-site="{{.Switch.Site}}">
  <div class="switch-title">{{.Switch.Name}} ({{.Switch.IPAddress}})</div>

  <!-- Front panel layout: odd ports on top, even ports below -->
  <div class="port-panel">
    <div class="port-row">
      {{range .Ports}}
        {{if eq (mod .Index 2) 1}}
          <div class="port {{if eq .Status "UP"}} up {{else if and (eq .Status "DOWN") (gt .StatusChanges 0)}} flap {{else}} down {{end}}" onclick="togglePortDetail({{.SwitchID}}, {{.Index}})" title="Port {{.Index}}">
            {{.DisplayName}}
          </div>
        {{end}}
      {{end}}
    </div>
    <div class="port-row">
      {{range .Ports}}
        {{if eq (mod .Index 2) 0}}
          <div class="port {{if eq .Status "UP"}} up {{else if and (eq .Status "DOWN") (gt .StatusChanges 0)}} flap {{else}} down {{end}}" onclick="togglePortDetail({{.SwitchID}}, {{.Index}})" title="Port {{.Index}}">
            {{.DisplayName}}
          </div>
        {{end}}
      {{end}}
    </div>
  </div>

  <!-- Port details hidden by default -->
  {{range .Ports}}
  <div class="port-details" id="port-detail-{{.SwitchID}}-{{.Index}}">
    <p>Port: {{.Name}}</p>
    <p>Status: <span class="{{if eq .Status "UP"}}up-text{{else}}down-text{{end}}">{{.Status}}</span></p>
    <p>Status changes: {{.StatusChanges}}</p>
    <h4>MAC Addresses</h4>
    <table>
      <thead>
        <tr>
          <th>MAC</th>
          <th>VLAN</th>
        </tr>
      </thead>
      <tbody>
        {{if .Macs}}
          {{range .Macs}}
            <tr>
              <td>{{.MAC}}</td>
              <td>{{.VLAN}}</td>
            </tr>
          {{end}}
        {{else}}
          <tr><td colspan="2">No MACs</td></tr>
        {{end}}
      </tbody>
    </table>
  </div>
  {{end}}

</div>
{{end}}
</body>
</html>
